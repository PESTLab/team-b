{% extends "base.html" %}

{% block content %}

<script>
$('#myTab a').click(function (e) {
  e.preventDefault();
  $(this).tab('show');
})



</script>

<script>
  $(function() {
    $( ".sortable" ).sortable({
      cancel: ".ui-state-disabled",
        revert:300
    });
    $( ".sortable" ).disableSelection();
  });


  $(function() {
      $('#deletepagebtn').live('click', function(){
        $(this).closest('li').remove();
    });
  });

$(function() {
      $('#deletefunnelbtn').live('click', function(){
        $(this).closest('li.active').remove();
    });
  });





</script>

<script type="text/javascript">
function addtext(pgname, id, fid){
    if (document.createTextNode)
    {
    var newpgname=document.createTextNode(pgname)
    var newpgid=document.createTextNode(id)

    var str1 = "funnel";
    var str2 = String(fid)
    var res = str1.concat(str2);

    var newpg=document.createElement('li')
    newpg.setAttribute('class', 'ui-state-default t')
    newpg.setAttribute('id', id)

    var newpnl = document.createElement('div')
    newpnl.setAttribute('class', 'panel panel-default')

    var newpnlhead = document.createElement('div')
    newpnlhead.setAttribute('class', 'panel-heading')

    var newh3 = document.createElement('h3')
    newh3.setAttribute('class', 'panel-title')

    var newb = document.createElement('b')
    newb.appendChild(newpgname)

    newh3.appendChild(newb)

    var newpnlbod = document.createElement('div')
    newpnlbod.setAttribute('class', 'panel-body')
    newpnlbod.appendChild(newpgid)

    newpnlhead.appendChild(newh3)
    newpnl.appendChild(newpnlhead)
    newpnl.appendChild(newpnlbod)
    newpg.appendChild(newpnl)
    document.getElementById(res).appendChild(newpg)
    }
}


</script>

<script>
function setpgids(){
var ids = "";
var searchEles = document.getElementById("sortable").children;
for(var i = 0; i < searchEles.length; i++)
{
    ids += searchEles[i].id
    ids += ","
}

document.getElementById("idsinput").value = ids;
}



</script>

        

<div class="container">
    <h1>Manage Campaigns</h1>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title"><b>{{c.name}} Campaign</b></h3>
        </div>
        <div class="panel-body">

            <div id="content">
                <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">

                    <li class="active"><a href="#red" data-toggle="tab">Details</a></li>
                    {% for f in funnels %}
                    <li><a href="#{{f.id}}" data-toggle="tab">{{f.name}}</a></li>
                    {% endfor %}
                    <li><a href="#newfunnel" data-toggle="tab">New Funnel</a></li>
                </ul>
                <div id="my-tab-content" class="tab-content">

                    <div class="tab-pane active" id="red">
                        <h1>Details</h1>

                    </div>

                    {% for f in funnels %}
                    <div class="tab-pane" id="{{f.id}}">
                        <div class="controls">
                            <button id="deletefunnelbtn" name="deletebutton" class="btn btn-primary" style="float: right;">Delete Funnel</button>
                        </div>
                        <h1>{{f.name}}</h1>

                        <div class="panel panel-default">
                            <div class="panel-body">
								{{f.content_ids}}
                                <ul class="sortable" id ="funnel{{f.id}}">
								{% if f.content_ids != none %}
                                    {% for c in f.content_ids | list %}
                                        {% if c != ',' %}
                                            {% for p in allfiles%}

                                                {% if p.id == c|int %}
                                                    <li class="ui-state-default t" id="{{c}}">
                                                        <div class="panel panel-default">
                                                            <div class="panel-heading"><h3 class="panel-title"><b>{{p.page_name}}</b></h3>
                                                            </div>
                                                            <div class="panel-body">{{p.id}}</div>
                                                        </div>
                                                    </li>
                                                {%endif%}
                                            {%endfor%}
                                        {%endif%}

                                    {% endfor %}
                                {% endif %}

                                </ul>

                            </div>
                        </div>

                        <div style="margin-bottom: 2%">
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1"
                                style="display: block; position: static; margin-bottom: 2%; *width: 180px;">
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Add New Element</a>
                                    <ul class="dropdown-menu">
                                        <li class="dropdown-submenu">
                                            <a href="#">Landing Page</a>
                                            <ul class="dropdown-menu">
                                                <li class="dropdown-submenu">
                                                    <a href="#">Download Page</a>
                                                    <ul class="dropdown-menu">
                                                        {% for f in allfiles %}
                                                        {% if f.page_type == "download" %}
                                                        <li onClick="{% set pgids = pgids ~ ',' ~ f.id %} addtext('{{f.page_name}}', {{f.id}})"><a href="#">{{f.page_name}}</a></li>
                                                        {% endif %}
                                                        {% endfor %}
                                                    </ul>
                                                </li>
                                                <li class="dropdown-submenu">
                                                    <a href="#">Purchase Page</a>
                                                    <ul class="dropdown-menu">
                                                        {% for f in allfiles %}
                                                        {% if f.page_type == "purchase" %}
                                                        <li onClick="addtext('{{f.page_name}}', {{f.id}})"><a href="#">{{f.page_name}}</a></li>
                                                        {% endif %}
                                                        {% endfor %}
                                                    </ul>
                                                </li>
                                                <li class="dropdown-submenu">
                                                    <a href="#">Product Page</a>
                                                    <ul class="dropdown-menu">
                                                        {% for f in allfiles %}
                                                        {% if f.page_type == "product" %}
                                                        <li onClick="addtext('{{f.page_name}}', {{f.id}})"><a href="#">{{f.page_name}}</a></li>
                                                        {% endif %}
                                                        {% endfor %}
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div style="clear: left">

							<form role="form" action="{{ url_for('setfunids') }}" method="get" name="adduser">
								<input id="idsinput" type="hidden" name="pgids" value="">
								<input id="fid" type="hidden" name="fun_id" value="{{f.id}}">
								<input id="cid" type="hidden" name="cid" value="{{c.id}}">
								<button class="btn btn-primary" type="submit" onclick="setpgids()">Save Changes</button>
							</form>

                        </div>

                    </div>


                    {% endfor %}

                    <div class="tab-pane" id="newfunnel">
                        <h1>New Funnel</h1>

                        <form class="form-horizontal" role="form" action="" method="post" name="adduser"
                              enctype="multipart/form-data">
                            {{form.hidden_tag()}}
                            <div class="form-group">
                                <div class="col-sm-offset-0.5 col-sm-5">
                                    <label>Funnel Name</label>
                                    {{ form.funnel_name(placeholder='Enter Funnel Name', class="form-control")}}
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-offset-0.5 col-sm-5">
                                    <label>Product Name</label>
                                    {{ form.product_name(placeholder='Enter Product Name', class="form-control")}}
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label" for="singlebutton"></label>
                                <br>

                                <div class="controls">
                                    <button id="singlebutton" name="singlebutton" class="btn btn-primary">Add Funnel
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>


        </div>
    </div>
</div>
{% endblock %}